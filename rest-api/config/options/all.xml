<?xml version="1.0" encoding="UTF-8"?>
<options xmlns="http://marklogic.com/appservices/search">
  <search-option>unfiltered</search-option>
  <page-length>10</page-length>
  <term apply="term">
    <empty apply="all-results"/>
    <term-option>punctuation-insensitive</term-option>
    <term-option>wildcarded</term-option>
  </term>
  <grammar>
    <quotation>"</quotation>
    <implicit>
      <cts:and-query strength="20" xmlns:cts="http://marklogic.com/cts"/>
    </implicit>
    <starter strength="30" apply="grouping" delimiter=")">(</starter>
    <starter strength="40" apply="prefix" element="cts:not-query">-</starter>
    <joiner strength="10" apply="infix" element="cts:or-query" tokenize="word">OR</joiner>
    <joiner strength="20" apply="infix" element="cts:and-query" tokenize="word">AND</joiner>
    <joiner strength="30" apply="infix" element="cts:near-query" tokenize="word">NEAR</joiner>
    <joiner strength="30" apply="near2" consume="2" element="cts:near-query">NEAR/</joiner>
    <joiner strength="50" apply="constraint">:</joiner>
    <joiner strength="50" apply="constraint" compare="LT" tokenize="word">LT</joiner>
    <joiner strength="50" apply="constraint" compare="LE" tokenize="word">LE</joiner>
    <joiner strength="50" apply="constraint" compare="GT" tokenize="word">GT</joiner>
    <joiner strength="50" apply="constraint" compare="GE" tokenize="word">GE</joiner>
    <joiner strength="50" apply="constraint" compare="NE" tokenize="word">NE</joiner>
  </grammar>
  <default-suggestion-source>
    <word-lexicon/>
  </default-suggestion-source>
  
  <!-- ML7 / JSONXML -->
  
  <constraint name="ml7_domain">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index
        xmlns:jbasic="http://marklogic.com/xdmp/json/basic">jbasic:domains/jbasic:item</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="ml7_feature">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index
        xmlns:jbasic="http://marklogic.com/xdmp/json/basic">jbasic:features/jbasic:item</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="ml7_technology">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index
        xmlns:jbasic="http://marklogic.com/xdmp/json/basic">jbasic:technologies/jbasic:item</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="ml7_contact">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <element ns="http://marklogic.com/xdmp/json/basic" name="personName"/>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="ml7_version">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <element ns="http://marklogic.com/xdmp/json/basic" name="version"/>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>

  <values name="ml7_features">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <path-index
        xmlns:jbasic="http://marklogic.com/xdmp/json/basic">jbasic:features/jbasic:item</path-index>
      <facet-option>frequency-order</facet-option>
    </range>
  </values>
  <values name="ml7_technologies">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <path-index
        xmlns:jbasic="http://marklogic.com/xdmp/json/basic">jbasic:technologies/jbasic:item</path-index>
      <facet-option>frequency-order</facet-option>
    </range>
  </values>

  <tuples name="ml7_name-uri">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <element ns="http://marklogic.com/xdmp/json/basic" name="name" />
    </range>
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <uri />
    </range>
  </tuples>

  <!-- ML8 / JSON -->
  <constraint name="domain">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index>domains</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="feature">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index>features</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="technology">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <path-index>technologies</path-index>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="contact">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <element ns="" name="personName"/>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="version">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint" facet="true">
      <element ns="" name="version"/>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
    </range>
  </constraint>
  <constraint name="attachment">
    <custom>
      <parse apply="parse-structured" ns="http://marklogic.com/grouping-constraint" at="/ext/mlpm_modules/ml-constraints/grouping-constraint.xqy"/>
      <start-facet apply="start" ns="http://marklogic.com/grouping-constraint" at="/ext/mlpm_modules/ml-constraints/grouping-constraint.xqy"/>
      <finish-facet apply="finish" ns="http://marklogic.com/grouping-constraint" at="/ext/mlpm_modules/ml-constraints/grouping-constraint.xqy"/>
      <facet-option>limit=25</facet-option>
      <facet-option>frequency-order</facet-option>
      <facet-option>descending</facet-option>
      <facet-option>document</facet-option>
    </custom>
    <annotation>
      <range type="xs:string" facet="true" collation="http://marklogic.com/collation/codepoint">
        <field name="attachment-type"/>
      </range>
      <!-- 
        The MIME types specified here are those that exist in the ENRON data set (for the purposes of demoing).
        A possible better approach is to enrich content-type with a group or category based on a master list 
        of popular or pertinent MIME types.
      -->
      <config>
        <group label="Images">
            <match pattern="image/*"/>
        </group>
        <group label="Audio">
          <match pattern="audio/*"/>
        </group>
        <group label="Video">
          <match pattern="video/*"/>
          <match pattern="application/vnd.rn-realmedia"/>
          <match pattern="youtube"/>
        </group>
        <group label="Archive Files">
          <match pattern="application/vnd.ms-cab-compressed"/>
          <match pattern="application/*zip"/>
        </group>
        <group label="Binaries / Apps">
          <match pattern="application/x-exe"/>
          <match pattern="application/x-shockwave-flash"/>
          <match pattern="application/octet-stream"/>
        </group>
        <group label="Database Files">
          <match pattern="application/dBASEIII"/>
          <match pattern="application/x-paradox-db"/>
          <match pattern="application/x-microsoft-access"/>
        </group>
        <group label="Documents">
          <match pattern="application/msword"/>
          <match pattern="application/vnd.wordperfect"/>
          <match pattern="application/x-wordstar"/>
          <match pattern="application/pdf"/>
          <match pattern="application/postscript"/>
          <match pattern="application/rtf"/>
          <match pattern="application/x-xywrite"/>
          <match pattern="application/x-mass11"/>
          <match pattern="application/vnd.openxmlformats-officedocument.wordprocessingml*"/>
          <match pattern="application/vnd.ms-word*"/>
        </group>
        <group label="Spreadsheets">
          <match pattern="application/vnd.ms-excel*"/>
          <match pattern="application/vnd.openxmlformats-officedocument.spreadsheetml*"/>
        </group>
        <group label="Presentations">
          <match pattern="application/vnd.ms-powerpoint*"/>
          <match pattern="application/vnd.openxmlformats-officedocument.presentationml*"/>
        </group>
        <group label="Other Documents">
          <match pattern="application/acad"/>
          <match pattern="application/ms-project"/>
          <match pattern="application/ms-works"/>
          <match pattern="application/vnd.ms-works"/>
          <match pattern="application/vnd.visio"/>
          <match pattern="application/x-microsoft-publisher"/>
          <match pattern="application/x-uniplex"/>
        </group>
        <group label="Business Cards">
          <match pattern="text/x-vcard"/>
        </group>
        <group label="Email &amp; Mailboxes">
          <match pattern="application/EML"/>
          <match pattern="application/mbox"/>
        </group>
        <!-- 
          There is no accurate pattern to match "Other" attachment types
          and the show-remaining would include documents without attachments.
          Current limitation of ml-constraints. 
          -->
      </config>
    </annotation>
  </constraint>

  <values name="domains">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <path-index>domains</path-index>
      <facet-option>frequency-order</facet-option>
    </range>
  </values>
  <values name="features">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <path-index>features</path-index>
      <facet-option>frequency-order</facet-option>
    </range>
  </values>
  <values name="technologies">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <path-index>technologies</path-index>
      <facet-option>frequency-order</facet-option>
    </range>
  </values>
  
  <tuples name="name-uri">
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <element ns="" name="name" />
    </range>
    <range type="xs:string" collation="http://marklogic.com/collation/codepoint">
      <uri />
    </range>
  </tuples>
  
  <sort-order type="xs:dateTime"
      direction="descending">
    <element ns="" name="lastModifiedAt"/>
  </sort-order>
  <sort-order type="xs:dateTime"
      direction="descending">
    <element ns="http://marklogic.com/xdmp/json/basic" name="lastModifiedAt"/>
  </sort-order>
  <sort-order type="xs:string"
      collation="http://marklogic.com/collation/codepoint"
      direction="ascending">
    <element ns="" name="name"/>
  </sort-order>
  <sort-order type="xs:string"
      collation="http://marklogic.com/collation/codepoint"
      direction="ascending">
    <element ns="http://marklogic.com/xdmp/json/basic" name="name"/>
  </sort-order>
  <sort-order direction="descending">
    <score/>
  </sort-order>
  <transform-results apply="snippet">
    <preferred-elements><element ns="" name="body"/></preferred-elements>
    <max-matches>1</max-matches>
    <max-snippet-chars>150</max-snippet-chars>
    <per-match-tokens>20</per-match-tokens>
  </transform-results>
  <return-query>1</return-query>

  <operator name="results">
    <state name="compact">
      <!-- extract-metadata nor extract-doc-content work nicely with JSON, using raw snippet to get content -->
      <transform-results apply="raw"/>
    </state>
  </operator>
  <!-- extract-metadata nor extract-doc-content work nicely with JSON, using raw snippet to get content -->
  <transform-results apply="raw"/>

  <extract-metadata>
    <qname elem-ns="http://marklogic.com/xdmp/json/basic" elem-name="name"/>
    <constraint-value ref="version"/>
    <constraint-value ref="feature"/>
    <constraint-value ref="technology"/>
    <qname elem-ns="http://marklogic.com/xdmp/json/basic" elem-name="restricted"/>
    <qname elem-ns="http://marklogic.com/xdmp/json/basic" elem-name="desc"/>
    <qname elem-ns="http://marklogic.com/xdmp/json/basic" elem-name="description"/>
    <qname elem-ns="http://marklogic.com/xdmp/json/basic" elem-name="shortdesc"/>
  </extract-metadata>

  <annotation>Delta options here</annotation>
  <additional-query>
    <cts:directory-query xmlns:cts="http://marklogic.com/cts">
      <cts:uri>/demos/</cts:uri>
    </cts:directory-query>
  </additional-query>
</options>
